/**
 * Created by Administrator on 17.3.28.
 */
var areaJSONdata = {"Region":{"RegionName":"区域","Citylist":[{"CityID":"3302","CityName":"宁波","Countrylist":[{"CountryCode":"22902","CountryName":"宁波海曙"},{"CountryCode":"22903","CountryName":"宁波江东"},{"CountryCode":"22904","CountryName":"宁波江北"},{"CountryCode":"22905","CountryName":"宁波镇海"},{"CountryCode":"22906","CountryName":"宁波鄞州"},{"CountryCode":"22907","CountryName":"宁波慈溪"},{"CountryCode":"22908","CountryName":"宁波余姚"},{"CountryCode":"22909","CountryName":"宁波宁海"},{"CountryCode":"22910","CountryName":"宁波奉化"},{"CountryCode":"22911","CountryName":"宁波北仑"},{"CountryCode":"22912","CountryName":"宁波象山"}]},{"CityID":"3303","CityName":"温州","Countrylist":[{"CountryCode":"22913","CountryName":"温州鹿城"},{"CountryCode":"22914","CountryName":"温州瓯海"},{"CountryCode":"22915","CountryName":"温州龙湾"},{"CountryCode":"22916","CountryName":"温州乐清"},{"CountryCode":"22917","CountryName":"温州瑞安"},{"CountryCode":"22918","CountryName":"温州苍南"},{"CountryCode":"22919","CountryName":"温州平阳"},{"CountryCode":"22920","CountryName":"温州洞头"},{"CountryCode":"22921","CountryName":"温州泰顺"},{"CountryCode":"22922","CountryName":"温州文成"},{"CountryCode":"22923","CountryName":"温州永嘉"}]},{"CityID":"3306","CityName":"绍兴","Countrylist":[{"CountryCode":"22924","CountryName":"绍兴柯桥"},{"CountryCode":"22925","CountryName":"绍兴越城"},{"CountryCode":"22926","CountryName":"绍兴诸暨"},{"CountryCode":"22927","CountryName":"绍兴新昌"},{"CountryCode":"22928","CountryName":"绍兴上虞"},{"CountryCode":"22929","CountryName":"绍兴嵊州"}]},{"CityID":"3304","CityName":"嘉兴","Countrylist":[{"CountryCode":"22930","CountryName":"嘉兴海宁"},{"CountryCode":"22931","CountryName":"嘉兴桐乡"},{"CountryCode":"22932","CountryName":"嘉兴嘉善"},{"CountryCode":"22933","CountryName":"嘉兴海盐"},{"CountryCode":"22934","CountryName":"嘉兴平湖"},{"CountryCode":"22935","CountryName":"嘉兴秀洲"},{"CountryCode":"22936","CountryName":"嘉兴南湖"}]},{"CityID":"3305","CityName":"湖州","Countrylist":[{"CountryCode":"22937","CountryName":"湖州吴兴"},{"CountryCode":"22938","CountryName":"湖州南浔"},{"CountryCode":"22939","CountryName":"湖州德清"},{"CountryCode":"22940","CountryName":"湖州长兴"},{"CountryCode":"22941","CountryName":"湖州安吉"}]},{"CityID":"3310","CityName":"台州","Countrylist":[{"CountryCode":"22942","CountryName":"台州椒江"},{"CountryCode":"22943","CountryName":"台州路桥"},{"CountryCode":"22944","CountryName":"台州黄岩"},{"CountryCode":"22945","CountryName":"台州温岭"},{"CountryCode":"22946","CountryName":"台州玉环"},{"CountryCode":"22947","CountryName":"台州临海"},{"CountryCode":"22948","CountryName":"台州天台"},{"CountryCode":"22949","CountryName":"台州仙居"},{"CountryCode":"22950","CountryName":"台州三门"}]},{"CityID":"3307","CityName":"金华","Countrylist":[{"CountryCode":"22951","CountryName":"金华婺城"},{"CountryCode":"22952","CountryName":"金华永康"},{"CountryCode":"22953","CountryName":"金华东阳"},{"CountryCode":"22954","CountryName":"金华兰溪"},{"CountryCode":"22955","CountryName":"金华武义"},{"CountryCode":"22956","CountryName":"金华浦江"},{"CountryCode":"22957","CountryName":"金华磐安"},{"CountryCode":"22958","CountryName":"金华金东"}]},{"CityID":"3312","CityName":"义乌","Countrylist":[{"CountryCode":"22959","CountryName":"义乌市区"}]},{"CityID":"3311","CityName":"丽水","Countrylist":[{"CountryCode":"22960","CountryName":"丽水莲都"},{"CountryCode":"22961","CountryName":"丽水龙泉"},{"CountryCode":"22962","CountryName":"丽水缙云"},{"CountryCode":"22963","CountryName":"丽水遂昌"},{"CountryCode":"22964","CountryName":"丽水松阳"},{"CountryCode":"22965","CountryName":"丽水云和"},{"CountryCode":"22966","CountryName":"丽水景宁"},{"CountryCode":"22967","CountryName":"丽水庆元"},{"CountryCode":"22968","CountryName":"丽水青田"}]},{"CityID":"3308","CityName":"衢州","Countrylist":[{"CountryCode":"22969","CountryName":"衢州柯城"},{"CountryCode":"22970","CountryName":"衢州龙游"},{"CountryCode":"22971","CountryName":"衢州江山"},{"CountryCode":"22972","CountryName":"衢州常山"},{"CountryCode":"22973","CountryName":"衢州开化"},{"CountryCode":"22974","CountryName":"衢州衢江"}]},{"CityID":"3309","CityName":"舟山","Countrylist":[{"CountryCode":"22975","CountryName":"舟山嵊泗"},{"CountryCode":"22976","CountryName":"舟山普陀"},{"CountryCode":"22977","CountryName":"舟山定海"},{"CountryCode":"22978","CountryName":"舟山岱山"}]},{"CityID":"3301","CityName":"杭州","Countrylist":[{"CountryCode":"22888","CountryName":"杭州上城"},{"CountryCode":"22890","CountryName":"杭州下城"},{"CountryCode":"22891","CountryName":"杭州西湖"},{"CountryCode":"22892","CountryName":"杭州拱墅"},{"CountryCode":"22893","CountryName":"杭州江干"},{"CountryCode":"22894","CountryName":"杭州萧山"},{"CountryCode":"22895","CountryName":"杭州滨江"},{"CountryCode":"22896","CountryName":"杭州余杭"},{"CountryCode":"22897","CountryName":"杭州富阳"},{"CountryCode":"22898","CountryName":"杭州临安"},{"CountryCode":"22899","CountryName":"杭州桐庐"},{"CountryCode":"22900","CountryName":"杭州建德"},{"CountryCode":"22901","CountryName":"杭州淳安"},{"CountryCode":"25803","CountryName":"上城区"}]},{"CityID":"3399","CityName":"未分配","Countrylist":[{"CountryCode":"25804","CountryName":"临时"}]}]}};
var cityList = areaJSONdata.Region.Citylist;
var countryList = "";   //cityList[0].Countrylist;
;$(function () {
      var Ycity = "", Ydl2Con = "", Ycountry = [];      //市、村（JSON数据里的）
      var Yarea = $("#Y_SelArea"), Ydl1 = Yarea.find(".y_dl1"), YcountryWrap = Yarea.find(".yCountryWrap");
      for(var i = 0, len = cityList.length; i < len; i++){
            var countryStr = "";
            if(i == 0){
                  Ycity = '<a class="on" href="javascript:;" data-prono="'+ i +'" data-cityid="'+ cityList[i].CityID +'">\
                                    <span class="yProvinceName">'+ cityList[i].CityName +'</span>\
                                    <span class="del hide"></span>\
                              </a>';
                  Ydl2Con = '<dl class="y_dl2 clearfix">\
                                    <dt class="pull-left"><label><input class="ySelAll" type="checkbox"> 全选</label></dt>\
                                    <dd class="clearfix yCountry"></dd>\
                              </dl>';
                  countryList = cityList[i].Countrylist;
                  for(var j = 0, len2 = countryList.length; j < len2; j++){
                        countryStr += '<a class="" href="javascript:;" data-countrycode="'+ countryList[j].CountryCode +'">\
                                          <span class="yProvinceName">'+ countryList[j].CountryName +'</span>\
                                          <span class="del hide"></span>\
                                    </a>';
                  }
                  Ycountry[i] = countryStr;
                  continue;
            }
            Ycity += '<a class="" href="javascript:;" data-prono="'+ i +'" data-cityid="'+ cityList[i].CityID +'">\
                              <span class="yProvinceName">'+ cityList[i].CityName +'</span>\
                              <span class="del hide"></span>\
                        </a>';
            Ydl2Con += '<dl class="y_dl2 clearfix" style="display:none">\
                              <dt class="pull-left"><label><input class="ySelAll" type="checkbox"> 全选</label></dt>\
                              <dd class="clearfix yCountry"></dd>\
                        </dl>';
            countryList = cityList[i].Countrylist;
            for(var j = 0, len2 = countryList.length; j < len2; j++){
                  countryStr += '<a class="" href="javascript:;" data-countrycode="'+ countryList[j].CountryCode +'">\
                                          <span class="yProvinceName">'+ countryList[j].CountryName +'</span>\
                                          <span class="del hide"></span>\
                                    </a>';
            }
            Ycountry[i] = countryStr;
      }
      Ydl1.find(".yCity").html(Ycity);
      YcountryWrap.html(Ydl2Con);
      for(var i2 = 0, len2 = cityList.length; i2 < len2; i2++){
            YcountryWrap.find(".y_dl2").eq(i2).find(".yCountry").html(Ycountry[i2]);
      }
      //全选-市
      Ydl1.find(".ySelAll").click(function () {
            var isSel = $(this).prop("checked");
            // console.log(isSel)
            if(isSel){
                  Ydl1.find(".yCity a").addClass("ySel").removeClass("ySel2 ySel3").children(".del").removeClass("hide");
                  YcountryWrap.show().find(".yCountry a").addClass("ySel").children(".del").removeClass("hide");
            }else{
                  Ydl1.find(".yCity a").removeClass("ySel").children(".del").addClass("hide");
                  YcountryWrap.hide().find(".yCountry a").removeClass("ySel").children(".del").addClass("hide");
            }
            YcountryWrap.find(".ySelAll").prop("checked", isSel);
      });
      //市点击
      Ydl1.find(".yCity").on("click", "a", function () {
            $(this).addClass("on").siblings("a").removeClass("on");
            var NO = $(this).attr("data-prono");
            // console.log(NO)
            YcountryWrap.show().find(".y_dl2").eq(NO).show().siblings(".y_dl2").hide();
            if($(this).hasClass("ySel2") || $(this).hasClass("ySel3")){

            }else{
                  $(this).addClass("ySel").removeClass("ySel2 ySel3").children(".del").removeClass("hide");
                  YcountryWrap.find(".y_dl2").eq(NO).find(".ySelAll").prop("checked", true);
                  YcountryWrap.find(".y_dl2").eq(NO).find(".yCountry a").addClass("ySel").children(".del").removeClass("hide");
                  if($(this).siblings("a.ySel").length == $(this).siblings("a").length){
                        Ydl1.find(".ySelAll").prop("checked", true);
                  }
            }
      });
      //市删除
      Ydl1.find(".yCity").on("click", "a .del", function (e) {
            e.stopPropagation();
            Ydl1.find(".ySelAll").prop("checked", false);
            $(this).addClass("hide").parent().removeClass("ySel ySel2");
            var acton = YcountryWrap.find(".y_dl2").eq($(this).parent().index());
            acton.find(".ySelAll").prop("checked", false);
            acton.find(".yCountry a").removeClass("ySel").children(".del").addClass("hide");
            if(acton.is(":visible")){
                  YcountryWrap.hide();
            }
      });
      //全选-村
      YcountryWrap.on("click", ".y_dl2 .ySelAll", function () {
            var isSel = $(this).prop("checked");
            if(isSel){
                  $(this).parents(".y_dl2").find(".yCountry a").addClass("ySel").children(".del").removeClass("hide");
                  Ydl1.find(".yCity a.on").addClass("ySel").removeClass("ySel2 ySel3").children(".del").removeClass("hide");
                  if(Ydl1.find(".yCity a.on").siblings("a.ySel").length == Ydl1.find(".yCity a.on").siblings("a").length){
                        Ydl1.find(".ySelAll").prop("checked", true);
                  }
            }else{
                  $(this).parents(".y_dl2").find(".yCountry a").removeClass("ySel").children(".del").addClass("hide");
                  Ydl1.find(".yCity a.on").addClass("ySel3").removeClass("ySel").children(".del").addClass("hide");
                  Ydl1.find(".ySelAll").prop("checked", false);
            }
      });
      //村点击
      YcountryWrap.on("click", ".y_dl2 .yCountry a", function () {
            // console.log("村点击")
            if(!$(this).hasClass("ySel")){
                  $(this).addClass("ySel").children(".del").removeClass("hide");
                  if($(this).siblings("a.ySel").length == $(this).siblings("a").length){
                        $(this).parents(".y_dl2").find(".ySelAll").prop("checked", true);
                        Ydl1.find(".yCity a.on").addClass("ySel").removeClass("ySel2 ySel3").children(".del").removeClass("hide");
                  }else {
                        Ydl1.find(".yCity a.on").addClass("ySel2").removeClass("ySel ySel3").children(".del").removeClass("hide");
                  }
            }
      });
      //村删除
      YcountryWrap.on("click", ".y_dl2 .yCountry a .del", function (e) {
            e.stopPropagation();
            Ydl1.find(".ySelAll").prop("checked", false);
            $(this).addClass("hide").parent().removeClass("ySel");
            $(this).parents(".y_dl2").find(".ySelAll").prop("checked", false);
            // console.log($(this).parent().siblings("a.ySel").length)
            if($(this).parent().siblings("a.ySel").length == 0){
                  Ydl1.find(".yCity a.on").addClass("ySel3").removeClass("ySel2 ySel").children(".del").addClass("hide");
            }else {
                  Ydl1.find(".yCity a.on").addClass("ySel2").removeClass("ySel ySel3").children(".del").removeClass("hide");
            }
      });
      //获取值(市：YSelectedCity, 村：YSelectedCountry)
      $("#btnQuery").click(function () {
            var selectedStr = [], countryLen = YcountryWrap.find(".yCountry a.ySel").length;
            for(var v_index = 0; v_index < countryLen; v_index++){
                  selectedStr[v_index] = {};
                  var thisCountry = YcountryWrap.find(".yCountry a.ySel").eq(v_index);
                  selectedStr[v_index].CountryCode = thisCountry.attr("data-countrycode");
                  selectedStr[v_index].parentID = Ydl1.find("a").eq(thisCountry.parents(".y_dl2").index()).attr("data-cityid");
            }

            console.log(selectedStr);
      })

});
